@model PhoneStore_New.Models.ViewModels.ProfileViewModel
@{
    ViewBag.Title = "Hồ sơ cá nhân";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    /* CSS Layout Dashboard (Dùng chung cho cả Profile và ChangePassword) */
    .profile-wrapper {
        margin-top: 30px;
        margin-bottom: 60px;
    }

    /* Menu bên trái */
    .list-group-item {
        border-radius: 0;
        border-left: 3px solid transparent;
        transition: 0.2s;
        color: #555;
    }

        .list-group-item:hover {
            background-color: #f9f9f9;
            color: #333;
        }
        /* Trạng thái đang chọn (Active) */
        .list-group-item.active {
            background-color: #fff;
            color: #d0011b; /* Màu đỏ chủ đạo */
            border-color: #ddd;
            border-left: 3px solid #d0011b;
            font-weight: bold;
            z-index: 2;
        }

    .list-group-item-danger {
        color: #d9534f;
    }

        .list-group-item-danger:hover {
            background-color: #f2dede;
            color: #a94442;
        }

    /* Khung nội dung bên phải */
    .profile-content {
        background: #fff;
        border: 1px solid #e1e1e1;
        border-radius: 4px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.03);
    }

    .profile-header {
        padding: 15px 20px;
        border-bottom: 1px solid #eee;
        background: #fcfcfc;
    }

        .profile-header h3 {
            margin: 0;
            font-size: 18px;
            text-transform: uppercase;
            color: #333;
            font-weight: 700;
        }

    .profile-body {
        padding: 30px;
    }

    /* CSS Avatar */
    .avatar-wrapper {
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px dashed #eee;
    }

    .avatar-preview {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid #eee;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        margin-bottom: 15px;
    }

    .btn-upload-fake {
        border: 1px solid #ddd;
        background: #fff;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 13px;
        cursor: pointer;
        transition: 0.2s;
    }

        .btn-upload-fake:hover {
            background: #f1f1f1;
            border-color: #ccc;
        }

    /* Button Save */
    .btn-save {
        background-color: #007bff;
        color: white;
        padding: 10px 30px;
        font-weight: bold;
        border: none;
        transition: 0.3s;
    }

        .btn-save:hover {
            background-color: #0056b3;
            color: white;
        }
</style>

<div class="container profile-wrapper">
    <div class="row">
        @* === CỘT TRÁI: MENU ĐIỀU HƯỚNG === *@
        <div class="col-md-3">
            <div class="list-group shadow-sm">
                @* Link này đang Active *@
                <a href="@Url.Action("Index", "Profile")" class="list-group-item active">
                    <i class="glyphicon glyphicon-user"></i> Thông tin tài khoản
                </a>

                <a href="@Url.Action("History", "Order")" class="list-group-item">
                    <i class="glyphicon glyphicon-list-alt"></i> Lịch sử đơn hàng
                </a>

                @* Link sang trang Đổi mật khẩu *@
                <a href="@Url.Action("ChangePassword", "Profile")" class="list-group-item">
                    <i class="glyphicon glyphicon-lock"></i> Đổi mật khẩu
                </a>

                <a href="javascript:document.getElementById('logoutForm').submit()" class="list-group-item list-group-item-danger">
                    <i class="glyphicon glyphicon-log-out"></i> Đăng xuất
                </a>
            </div>
        </div>

        @* === CỘT PHẢI: FORM CẬP NHẬT THÔNG TIN === *@
        <div class="col-md-9">
            <div class="profile-content">
                <div class="profile-header">
                    <h3><i class="glyphicon glyphicon-pencil"></i> Cập nhật thông tin</h3>
                </div>
                <div class="profile-body">

                    @* Thông báo *@
                    @if (!string.IsNullOrEmpty(Model.Message))
                    {
                        <div class="alert @(Model.Message.Contains("thành công") ? "alert-success" : "alert-danger") alert-dismissible" role="alert">
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            @Model.Message
                        </div>
                    }

                    @using (Html.BeginForm("Index", "Profile", FormMethod.Post, new { @class = "form-horizontal", enctype = "multipart/form-data" }))
                    {
                        @Html.AntiForgeryToken()
                        @Html.HiddenFor(m => m.UserId)
                        @Html.HiddenFor(m => m.AvatarUrl)

                        @* PHẦN 1: ẢNH ĐẠI DIỆN *@
                        <div class="avatar-wrapper">
                            <img src="@Url.Content(string.IsNullOrEmpty(Model.AvatarUrl) ? "~/Content/images/autoimage.jpg" : Model.AvatarUrl)"
                                 alt="Avatar" class="avatar-preview" id="img-preview" />

                            <div>
                                <label for="ImageFile" class="btn-upload-fake">
                                    <i class="glyphicon glyphicon-camera"></i> Chọn ảnh mới
                                </label>
                                <input type="file" name="ImageFile" id="ImageFile" style="display:none;" accept="image/*" onchange="previewImage(this);" />
                            </div>
                            @Html.ValidationMessageFor(m => m.ImageFile, "", new { @class = "text-danger" })
                        </div>

                        @* PHẦN 2: THÔNG TIN CÁ NHÂN *@
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Tên đăng nhập</label>
                            <div class="col-sm-9">
                                @Html.TextBoxFor(m => m.Username, new { @class = "form-control", @readonly = "readonly", @style = "background-color: #f9f9f9;" })
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label">Họ & Tên đệm <span class="text-danger">*</span></label>
                            <div class="col-sm-9">
                                @Html.TextBoxFor(m => m.FirstName, new { @class = "form-control" })
                                @Html.ValidationMessageFor(m => m.FirstName, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label">Tên <span class="text-danger">*</span></label>
                            <div class="col-sm-9">
                                @Html.TextBoxFor(m => m.LastName, new { @class = "form-control" })
                                @Html.ValidationMessageFor(m => m.LastName, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label">Email <span class="text-danger">*</span></label>
                            <div class="col-sm-9">
                                @Html.TextBoxFor(m => m.Email, new { @class = "form-control", @type = "email" })
                                @Html.ValidationMessageFor(m => m.Email, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label">Số điện thoại</label>
                            <div class="col-sm-9">
                                @Html.TextBoxFor(m => m.PhoneNumber, new { @class = "form-control" })
                                @Html.ValidationMessageFor(m => m.PhoneNumber, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label">Địa chỉ</label>
                            <div class="col-sm-9">
                                @Html.TextAreaFor(m => m.Address, new { @class = "form-control", @rows = 3 })
                                @Html.ValidationMessageFor(m => m.Address, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group" style="margin-top: 30px;">
                            <div class="col-sm-offset-3 col-sm-9">
                                <button type="submit" class="btn btn-save">
                                    <i class="glyphicon glyphicon-floppy-disk"></i> Lưu thay đổi
                                </button>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@* Form ẩn để xử lý đăng xuất *@
@using (Html.BeginForm("Logout", "Login", FormMethod.Post, new { id = "logoutForm" }))
{
    @Html.AntiForgeryToken()
}

@section scripts {
    <script>
        // Script xem trước ảnh khi chọn
        function previewImage(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    $('#img-preview').attr('src', e.target.result);
                }
                reader.readAsDataURL(input.files[0]);
            }
        }
    </script>
}