@model IEnumerable<PhoneStore_New.Models.ViewModels.ProductCardViewModel>

@{
    ViewBag.Title = "Cửa hàng";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section styles {
    <style>
        body { background-color: #f5f5fa; }
        .shop-container { margin-top: 20px; }

        /* Grid sản phẩm */
        .product-list-row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -5px;
        }
        .product-col {
            width: 20%; /* 5 sản phẩm 1 hàng */
            padding: 5px;
            margin-bottom: 10px;
        }
        @@media (max-width: 992px) { .product-col { width: 25%; } } /* 4 sp */
       @@media (max-width: 768px) { .product-col { width: 50%; } } /* 2 sp */

        /* Card Style */
        .product-card { background: #fff; border: 1px solid #eee; border-radius: 4px; transition: all 0.2s; position: relative; height: 100%; display: flex; flex-direction: column; padding-bottom: 10px; }
        .product-card:hover { box-shadow: 0 5px 15px rgba(0,0,0,0.1); transform: translateY(-3px); border-color: #d0011b; z-index: 5; }

        .img-wrap { position: relative; padding-top: 100%; overflow: hidden; display: block; z-index: 1; }
        .img-wrap img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain; padding: 15px; transition: 0.3s; }
        .product-card:hover img { transform: scale(1.05); }

        .badge-discount { position: absolute; top: 10px; right: 10px; background: #ffe97a; color: #d0011b; font-size: 12px; font-weight: bold; padding: 3px 6px; border-radius: 4px; z-index: 10; }
        .badge-vip { position: absolute; top: 10px; left: 10px; background: #007bff; color: #fff; font-size: 11px; font-weight: bold; padding: 3px 6px; border-radius: 4px; z-index: 10; }

        .info-wrap { padding: 10px; flex-grow: 1; display: flex; flex-direction: column; }
        .prod-name { font-size: 14px; color: #333; margin: 0 0 5px; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; height: 40px; text-decoration: none; }
        .prod-name:hover { color: #d0011b; }

        .price-box { min-height: 40px; }
        .price-final { color: #d0011b; font-size: 16px; font-weight: 700; display: block; }
        .price-original { color: #999; font-size: 12px; text-decoration: line-through; margin-right: 5px; }

        .btn-add-cart { margin-top: 8px; width: 100%; background: #fff; color: #d0011b; border: 1px solid #d0011b; padding: 5px; font-size: 12px; font-weight: 600; text-align: center; border-radius: 4px; opacity: 0; transition: 0.2s; display: block; text-decoration: none; }
        .product-card:hover .btn-add-cart { opacity: 1; background: #d0011b; color: #fff; }

        .alert-empty { background: #fff; padding: 30px; text-align: center; border-radius: 8px; margin-top: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    </style>
}

<div class="container shop-container">
    @* --- BREADCRUMB HOẶC TIÊU ĐỀ --- *@
    <div style="background: #fff; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-bottom: 2px solid #d0011b;">
        <h2 style="margin: 0; font-size: 20px; font-weight: 700; text-transform: uppercase;">
            @if (ViewBag.CategoryName != null)
            {
                <span>Danh mục: @ViewBag.CategoryName</span>
            }
            else
            {
                <span>Tất cả sản phẩm</span>
            }
        </h2>
    </div>

    @* --- DANH SÁCH SẢN PHẨM --- *@
    @if (Model != null && Model.Any())
    {
        <div class="product-list-row">
            @foreach (var p in Model)
            {
                <div class="product-col">
                    <div class="product-card">
                        @if (p.DiscountPercentage > 0)
                        {
                            <span class="badge-discount">-@p.DiscountPercentage%</span>
                        }
                        @if (p.IsVipPrice)
                        {
                            <span class="badge-vip">VIP</span>
                        }

                        <a href="@Url.Action("Detail", "Product", new { id = p.ProductId })" class="img-wrap">
                            <img src="@Url.Content(p.ImageUrl ?? "~/Content/images/no-image.png")" alt="@p.Name">
                        </a>

                        <div class="info-wrap">
                            <a href="@Url.Action("Detail", "Product", new { id = p.ProductId })" class="prod-name">@p.Name</a>

                            <div class="price-box">
                                <span class="price-final">@p.FormattedFinalPrice</span>
                                @if (p.FinalPrice < p.OriginalPrice)
                                {
                                    <span class="price-original">@p.FormattedOriginalPrice</span>
                                }
                            </div>

                            @* Link trỏ về trang chi tiết *@
                            <a href="@Url.Action("Detail", "Product", new { id = p.ProductId })" class="btn-add-cart">
                                Mua Ngay
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="alert-empty">
            <h4 style="color: #666;">Không tìm thấy sản phẩm nào!</h4>
            <p>Vui lòng thử danh mục khác hoặc quay lại trang chủ.</p>
            <a href="@Url.Action("Index", "Home")" class="btn btn-primary" style="margin-top: 10px;">Về trang chủ</a>
        </div>
    }
</div>